<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Map-making · Harlequin.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>Harlequin.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li><a class="toctext" href="../genpointings/">Pointing generation</a></li><li class="current"><a class="toctext" href>Map-making</a><ul class="internal"><li><a class="toctext" href="#High-level-functions-1">High-level functions</a></li><li><a class="toctext" href="#Low-level-functions-1">Low-level functions</a></li></ul></li><li><a class="toctext" href="../examples/">Practical examples</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Map-making</a></li></ul><a class="edit-page" href="https://github.com/ziotom78/Harlequin.jl/blob/master/docs/src/mapmaking.md#L"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Map-making</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Map-making-1" href="#Map-making-1">Map-making</a></h1><p>Harlequin includes a routine that applies the destriping algorithm to time-ordered data, producing a maximum-likelihood map of the intensity and polarization signal.</p><p>The destriping algorithm used in the code is described in the paper <a href="https://dx.doi.org/10.1051/0004-6361/200912361"><em>Destiping CMB temperature and polarization maps</em></a>, Kurki-Suonio et al., A/A 506, 1511-1539 (2009), and the source code closely follows the terminology introduced in that paper.</p><p>The destriping algorithm is effective in removing 1/f noise originated within the detectors of an instrument, provided that the noise is uncorrelated among detectors. It requires the user to specify a <em>baseline</em>, i.e., the maximum time span in which the noise can be assumed to be uncorrelated (i.e., white).</p><p>Since the destriper is effective only when much data is available, it is often the case that the input data to be fed to the algorithm is larger than the available memory on a machine. In this case, the destriper can take advantage of a distributed-memory environment and of the MPI libraries.</p><h2><a class="nav-anchor" id="High-level-functions-1" href="#High-level-functions-1">High-level functions</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Harlequin.destripe!" href="#Harlequin.destripe!"><code>Harlequin.destripe!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">destripe!(obs_list, baselines, destriping_data; threshold, max_iterations, comm, unseen, callback, use_preconditioner) where {T &lt;: Number, O &lt;: Healpix.Order}</code></pre><p>Apply the destriping algorithm to the TOD in <code>obs_list</code>. The result is returned in <code>baselines</code> (set of baselines) and <code>destriping_data</code> (I/Q/U maps, weight map, M_p matrices).</p><p>The parameters must satisfy the following constraints:</p><ul><li><code>obs_list</code> must be an array of <code>N</code> <a href="@ref"><code>Observation</code></a> objects;</li><li><code>baselines</code> must be an array of <code>N</code> <code>RunLengthArray</code> objects; each of them must have all the values set to zero; the length of each run specifies the length of the baseline in terms of the samples in the TOD in <code>obs_list</code></li><li><code>destriping_data</code> must be a <a href="@ref"><code>DestripingData</code></a> object. It does not need to have been initialized using <a href="@ref"><code>reset_maps!</code></a>.</li></ul><p>The optional keyword have the following meaning and default value:</p><ul><li><p><code>max_iterations</code> is the maximum number of allowed iterations for the Conjugated Gradient algorithm. The default is 1000.</p></li><li><p><code>comm</code> is a MPI communicator object, or <code>nothing</code> is MPI is not used.</p></li><li><p><code>unseen</code> is the value to be used for pixels in the map that have not been observed. The default is <code>missing</code>; other sensible values are <code>nothing</code> and <code>NaN</code>.</p></li><li><p><code>callback</code> is either <code>nothing</code> (the default) or a function that is called before the CG algorithm starts, and then once every iteration. It can be used to monitor the progress of the destriper, or to save intermediate results in a database or a file. The function must accept the following parameters:</p><ol><li>Iteration number, starting from 1</li><li>Maximum number of iterations, equal to <code>max_iterations</code></li><li>Current stopping factor</li><li>The value of <code>destriping_data</code></li></ol></li></ul><p>The function uses Julia&#39;s <code>Logging</code> module. Therefore, you can enable the output of diagnostic messages, like in the following example:</p><pre><code class="language-julia">global_logger(ConsoleLogger(stderr, Debug))

# This command is going to produce a lot of output…
destripe!(...)</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/ziotom78/Harlequin.jl/blob/20a86ff50331177f19ca3d8f92c4136a9dd6b3a0/src/mapmaking.jl#LL849-L896">source</a></section><h2><a class="nav-anchor" id="Low-level-functions-1" href="#Low-level-functions-1">Low-level functions</a></h2><footer><hr/><a class="previous" href="../genpointings/"><span class="direction">Previous</span><span class="title">Pointing generation</span></a><a class="next" href="../examples/"><span class="direction">Next</span><span class="title">Practical examples</span></a></footer></article></body></html>
